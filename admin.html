<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Viewer</title>
  <style>
    body { background:#1e293b; color:#fff; text-align:center; padding:20px; }
    video { width:90%; max-width:400px; border-radius:12px; margin-top:20px; }
  </style>
</head>
<body>

<h1>Monitor Kamera Target</h1>
<video id="remoteVideo" autoplay playsinline></video>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const config = {
    apiKey: "AIzaSyDxgnLu6L...", 
    authDomain: "simulasi-kamera.firebaseapp.com",
    databaseURL: "https://simulasi-kamera-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "simulasi-kamera",
    storageBucket: "simulasi-kamera.firebasestorage.app",
    messagingSenderId: "924924454534",
    appId: "1:924924454534:web:8a3c34079aa1b0edd9d307",
  };

  const app = initializeApp(config);
  const db = getDatabase(app);

  const pc = new RTCPeerConnection();

  pc.ontrack = (event) => {
    document.getElementById("remoteVideo").srcObject = event.streams[0];
  };

  const callRef = ref(db, "webrtc/call");

  onValue(callRef, async snap => {
    const data = snap.val();
    if (!data) return;

    if (data.offer && !pc.currentRemoteDescription) {
      await pc.setRemoteDescription(new RTCSessionDescription(data.offer));

      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      await set(callRef, { ...data, answer });
    }
  });

  const candidateRef = ref(db, "webrtc/candidate_target");
  onValue(candidateRef, snap => {
    const c = snap.val();
    if (c) {
      pc.addIceCandidate(new RTCIceCandidate(c));
    }
  });

  pc.onicecandidate = (event) => {
    if (event.candidate) {
      set(ref(db, "webrtc/candidate_admin"), event.candidate);
    }
  };
</script>

</body>
</html>
