<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulasi Korban</title>
  <style>
    body { background:#0f172a; color:#e2e8f0; font-family:Arial; text-align:center; padding:20px; }
    video { width:100%; max-width:400px; border-radius:12px; margin-top:20px; }
    button { padding:12px; width:90%; max-width:320px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; margin-top:10px; }
    .on { background:#22c55e; color:#08341a; }
    .off { background:#ef4444; color:#fff; }
    .box{background:#1e293b;padding:15px;border-radius:12px;margin-top:20px;text-align:left;max-width:450px;margin:auto;}
    .title{font-weight:bold;margin-bottom:5px;}
  </style>
</head>
<body>

<h1>Simulasi Korban â€“ Akses Kamera</h1>
<p>Ketika kamu menekan Allow, kamera aktif dan status dikirim ke admin (tanpa video).</p>

<button id="start" class="on">Aktifkan Kamera</button>
<button id="stop" class="off" disabled>Matikan Kamera</button>

<video id="video" autoplay playsinline muted></video>

<div class="box">
  <div class="title">Informasi Perangkat:</div>
  <pre id="deviceInfo"></pre>
</div>

<script>
let stream = null;

function updateStatus(status){
  localStorage.setItem("camera_status", status);
  localStorage.setItem("camera_time", new Date().toLocaleTimeString());
}

function getDeviceInfo(){
  let info = "";

  info += "User-Agent: " + navigator.userAgent + "\n";
  info += "Resolusi layar: " + window.screen.width + " x " + window.screen.height + "\n";
  info += "Zona waktu: " + Intl.DateTimeFormat().resolvedOptions().timeZone + "\n";

  if (navigator.connection){
    info += "Koneksi: " + navigator.connection.effectiveType + "\n";
  }

  if (navigator.getBattery){
    navigator.getBattery().then(bat=>{
      info += "Baterai: " + Math.round(bat.level*100) + "%\n";
      document.getElementById("deviceInfo").textContent = info;
    });
  } else {
    document.getElementById("deviceInfo").textContent = info;
  }
}

document.getElementById("start").onclick = async () => {
  updateStatus("REQUESTING");

  try {
    stream = await navigator.mediaDevices.getUserMedia({ video:true });
    document.getElementById("video").srcObject = stream;

    updateStatus("CAMERA_ON");

    document.getElementById("start").disabled = true;
    document.getElementById("stop").disabled = false;
  }
  catch (e){
    updateStatus("DENIED");
    alert("Izin kamera ditolak.");
  }
};

document.getElementById("stop").onclick = () => {
  if (stream){
    stream.getTracks().forEach(t => t.stop());
    document.getElementById("video").srcObject = null;
  }
  updateStatus("CAMERA_OFF");

  document.getElementById("start").disabled = false;
  document.getElementById("stop").disabled = true;
};

window.onload = getDeviceInfo;
</script>

</body>
</html>
