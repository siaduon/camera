<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Target Kamera</title>
  <style>
    body { background:#0f172a; color:#fff; font-family:Arial; text-align:center; padding:20px; }
    video { width:90%; max-width:380px; border-radius:12px; margin-top:20px; }
    button { padding:12px 20px; margin-top:15px; border:none; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body>

<h1>Bagikan Kamera ke Admin</h1>
<p>Tekan tombol di bawah untuk mengaktifkan kamera dan mengizinkan admin melihat.</p>

<button id="startBtn">Aktifkan Kamera</button>
<video id="localVideo" autoplay playsinline muted></video>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const config = {
    apiKey: "AIzaSyDxgnLu6L...", 
    authDomain: "simulasi-kamera.firebaseapp.com",
    databaseURL: "https://simulasi-kamera-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "simulasi-kamera",
    storageBucket: "simulasi-kamera.firebasestorage.app",
    messagingSenderId: "924924454534",
    appId: "1:924924454534:web:8a3c34079aa1b0edd9d307",
  };

  const app = initializeApp(config);
  const db = getDatabase(app);

  const pc = new RTCPeerConnection();

  document.getElementById("startBtn").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
    document.getElementById("localVideo").srcObject = stream;

    stream.getTracks().forEach(track => pc.addTrack(track, stream));

    const callRef = ref(db, "webrtc/call");
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    await set(callRef, { offer });

    onValue(callRef, async snap => {
      const data = snap.val();
      if (!pc.currentRemoteDescription && data.answer) {
        await pc.setRemoteDescription(new RTCSessionDescription(data.answer));
      }
    });

    pc.onicecandidate = (event) => {
      if (event.candidate) {
        set(ref(db, "webrtc/candidate_target"), event.candidate);
      }
    };
  };
</script>

</body>
</html>
